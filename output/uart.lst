C51 COMPILER V9.00   UART                                                                  10/08/2010 21:43:32 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\output\uart.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\uart.c BROWSE DEBUG OBJECTEXTEND PRINT(.\output\uart.lst) OBJECT(.\outp
                    -ut\uart.obj)

line level    source

   1          #include<reg52.h>
   2          #include"uart.h"
   3          
   4          //-----------------0-9,A-F ASCII编码----------------------------
   5          unsigned char code NUM_STR[16] =
   6          {
   7                  0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,
   8                  0x38,0x39,0x41,0x42,0x43,0x44,0x45,0x46
   9          };
  10          //--------------------------------------------------------------
  11          
  12          //****************************串口初始化**********************************
  13          // 入口参数：   无
  14          // 出口参数：   无
  15          // 函数功能：   初始化串口
  16          // 使用方法：  需要使用串口时首先调用此函数
  17          //************************************************************************
  18          void UART_init(void)
  19          {
  20   1              TMOD = 0x20;                    // T1定时方式2(8位自动重装)
  21   1      
  22   1      //--------------设定波特率------------------------
  23   1      //======================9600bps=================================
  24   1      //      TH1 = 0xfd;                                     // 波特率9600 11.0592M
  25   1      //      TL1 = 0xfd;                                     // 256-11059200/12/32/9600 = 253(0xfd)
  26   1      //      SCON = 0x50;                    // 串口方式1   9600bps时使用
  27   1      
  28   1      //=======================4800bps================================
  29   1              TL1 = 0xfa;                  //11.0592M晶振波特率为4800bps
  30   1          TH1 = 0xfa;
  31   1              SCON = 0x50; //4
  32   1      
  33   1      //------------------------------------------------
  34   1              TR1 = 1;                        // 启动T1
  35   1      //      ES  = 1;                                // 允许串口中断
  36   1      
  37   1      }        
  38          
  39          //****************************串口发送字符串******************************
  40          // 入口参数：   *str:字符串首地址
  41          //                                      ENTER:(回车换行) 0：不换行  1：换行 
  42          // 出口参数：   无
  43          // 函数功能：   从串口发送一字符串
  44          //************************************************************************
  45          void UART_TXDSTRING( char *str, unsigned char ENTER)
  46          {
  47   1              while( *str )                                           // 输出字符直到字符串结束
  48   1              {
  49   2                      SBUF = *str;                                    // 发送当前字符
  50   2                      while( TI==0 ); TI = 0;         // 等待发送完成
  51   2                      str++;                                                  // 指针加1，下一字符
  52   2              }
  53   1      //---------------------------------------------------------
  54   1              if( ENTER!=0 )                                          // 是否需要输出换行
C51 COMPILER V9.00   UART                                                                  10/08/2010 21:43:32 PAGE 2   

  55   1              {
  56   2                      SBUF = 0x0d;                                    // 回车ASCII码
  57   2                      while( TI==0 ); TI = 0;         // 等待发送完成
  58   2                      SBUF=0x0a;                                              // 换行ASCII码
  59   2                      while( TI==0 ); TI = 0;         // 等待发送完成
  60   2              }
  61   1      }
  62          //**************************发送数字**************************************
  63          // 入口参数：   NUM:待发送数字（范围：0-255）
  64          //                                      ENTER:(回车换行) 0：不换行  1：换行 
  65          // 出口参数：   无
  66          // 函数功能：   从串口发送一数字
  67          //************************************************************************
  68          /*void UART_TXDNUMBER(unsigned char NUM,
  69                              unsigned char ENTER)
  70          {
  71                  unsigned char NUM_D[3];
  72                  ES = 0;                                                 // 禁止串口中断
  73                  NUM_D[0] = NUM/100;                     // 百位
  74                  NUM_D[1] = NUM%100/10;          // 十位
  75                  NUM_D[2] = NUM%10;                      // 个位
  76          //-----------------------------------------------------
  77                  SBUF = NUM_STR[NUM_D[0]];       // 装入百位数据
  78                  while( TI==0 ); TI = 0;         // 等待发送完成
  79                  SBUF = NUM_STR[NUM_D[1]];       // 装入十位数据
  80                  while( TI==0 ); TI = 0;         // 等待发送完成
  81                  SBUF = NUM_STR[NUM_D[2]];       // 装入个位数据
  82                  while( TI==0 ); TI = 0;         // 等待发送完成
  83          //-----------------------------------------------------
  84                  if( ENTER != 0 )                        // 是否需要回车换行
  85                  {
  86                          SBUF = 0x0d;                            // 回车ASCII码
  87                          while( TI==0 ); TI = 0; // 等待发送完成
  88                          SBUF=0x0a;                                      // 换行ASCII码
  89                          while( TI==0 ); TI = 0; // 等待发送完成
  90                  }
  91                  ES = 1;                                                 // 打开串口中断
  92          }       */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     56    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
